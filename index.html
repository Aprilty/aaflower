<!doctype html>
<html lang="th" class="h-full">
Â <head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  <title>AAFLOWERSHOP</title>
Â Â 
Â  <meta name="apple-mobile-web-app-capable" content="yes">
Â  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
Â  <meta name="mobile-web-app-capable" content="yes">
Â Â 
Â <link rel="icon" type="image/png" href="aaflower.png">
Â <link rel="apple-touch-icon" href="aaflower.png">

Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&amp;family=Prompt:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
Â Â 
Â  <style>
Â  Â  /* --- CSS à¸à¸·à¹‰à¸™à¸à¸²à¸™ --- */
Â  Â  body { box-sizing: border-box; touch-action: manipulation; -webkit-tap-highlight-color: transparent; overflow: hidden; }
Â  Â  * { font-family: 'Kanit', 'Prompt', sans-serif; }
Â  Â Â 
Â  Â  #falling-container {
Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  pointer-events: none; z-index: -1; overflow: hidden;
Â  Â  Â  Â  background: linear-gradient(180deg, #fff0f5 0%, #ffe4e6 100%);
Â  Â  }
Â  Â  .falling-item {
Â  Â  Â  Â  position: absolute; top: -10%;
Â  Â  Â  Â  animation-name: fall;
Â  Â  Â  Â  animation-timing-function: linear;
Â  Â  Â  Â  animation-iteration-count: infinite;
Â  Â  Â  Â  opacity: 0.6;
Â  Â  Â  Â  user-select: none;
Â  Â  }
Â  Â  @keyframes fall {
Â  Â  Â  Â  0% { transform: translateY(0) rotate(0deg) translateX(0px); opacity: 0; }
Â  Â  Â  Â  10% { opacity: 0.7; }
Â  Â  Â  Â  50% { transform: translateY(50vh) rotate(180deg) translateX(20px); }
Â  Â  Â  Â  100% { transform: translateY(110vh) rotate(360deg) translateX(-20px); opacity: 0; }
Â  Â  }
Â  Â  @keyframes wiggle {
Â  Â  Â  Â  0%, 100% { transform: rotate(-3deg) scale(1); }
Â  Â  Â  Â  50% { transform: rotate(3deg) scale(1.05); }
Â  Â  }
Â  Â  .cute-wiggle {
Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  animation: wiggle 2s ease-in-out infinite;
Â  Â  Â  Â  text-shadow: 2px 2px 0px rgba(249, 168, 212, 0.5);
Â  Â  }
Â  Â  @keyframes pop-in {
Â  Â  Â  Â  0% { opacity: 0; transform: translateY(-10px) scale(0.95); }
Â  Â  Â  Â  100% { opacity: 1; transform: translateY(0) scale(1); }
Â  Â  }
Â  Â  .pop-row {
Â  Â  Â  Â  animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
Â  Â  }
Â  Â Â 
Â  Â  /* Animation à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸¸à¹ˆà¸¡ Refresh */
Â  Â  @keyframes spin-once { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
Â  Â  .spin-anim { animation: spin-once 0.8s ease-in-out; }

Â  Â  /* --- Styles à¸­à¸·à¹ˆà¸™à¹† --- */
Â  Â  .input-group label { display: block; color: #be185d; font-weight: 600; font-size: 11px; margin-bottom: 2px; }
Â  Â  .input-field {
Â  Â  Â  width: 100%; height: 38px !important; padding: 0 10px; border: 1px solid #fbcfe8; border-radius: 8px;
Â  Â  Â  font-size: 14px; background-color: #ffffff; transition: all 0.2s; -webkit-appearance: none;
Â  Â  }
Â  Â  .input-field:focus { border-color: #ec4899; box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.15); outline: none; }
Â  Â Â 
Â  Â  .tgl-wrap { position: relative; display: inline-block; width: 34px; height: 18px; }
Â  Â  .tgl-inp { display: none; }
Â  Â  .tgl-bg {
Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  background-color: #e5e7eb; border-radius: 20px; transition: 0.3s;
Â  Â  Â  Â  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); cursor: pointer;
Â  Â  }
Â  Â  .tgl-ball {
Â  Â  Â  Â  position: absolute; top: 2px; left: 2px; width: 14px; height: 14px;
Â  Â  Â  Â  background-color: white; border-radius: 50%; transition: 0.3s;
Â  Â  Â  Â  box-shadow: 0 1px 2px rgba(0,0,0,0.2); pointer-events: none;
Â  Â  }
Â  Â  .tgl-inp:checked + .tgl-bg { background-color: #10b981; }
Â  Â  .tgl-inp:checked + .tgl-bg .tgl-ball { left: 18px; }

Â  Â  .addon-checkbox:checked + div {
Â  Â  Â  Â  background-color: #fce7f3;
Â  Â  Â  Â  border-color: #ec4899;
Â  Â  Â  Â  color: #be185d;
Â  Â  }

Â  Â  .glass-card {Â 
Â  Â  Â  Â  background: rgba(255, 255, 255, 0.85);Â 
Â  Â  Â  Â  backdrop-filter: blur(8px);Â 
Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.8);Â 
Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(236, 72, 153, 0.15);Â 
Â  Â  }
Â  Â  .color-btn { width: 26px; height: 26px; border-radius: 50%; cursor: pointer; border: 2px solid white; flex-shrink: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
Â  Â  .color-btn.selected { border-color: #ec4899; transform: scale(1.2); ring: 2px solid #ec4899; }
Â  Â Â 
Â  Â  .custom-table { width: 100%; border-collapse: separate; border-spacing: 0; }
Â  Â  .custom-table th {
Â  Â  Â  background-color: rgba(255, 255, 255, 0.9);
Â  Â  Â  color: #be185d; font-weight: 600; font-size: 11px; padding: 10px 4px;
Â  Â  Â  text-align: left; border-bottom: 2px solid #fbcfe8; white-space: nowrap;
Â  Â  }
Â  Â  .custom-table td {
Â  Â  Â  padding: 8px 4px; border-bottom: 1px solid #fff0f5; vertical-align: middle;
Â  Â  Â  font-size: 13px; color: #374151;
Â  Â  }
Â  Â  .hide-scrollbar::-webkit-scrollbar { display: none; }
Â  Â  .scrollbar-pink::-webkit-scrollbar { width: 4px; height: 4px; }
Â  Â  .scrollbar-pink::-webkit-scrollbar-thumb { background: #f472b6; border-radius: 10px; }
Â  </style>
Â </head>
Â <body class="h-full">
Â Â 
Â  <div id="falling-container"></div>

Â  <div id="app" class="h-full w-full p-2 pb-0 max-w-xl mx-auto relative flex flex-col">
Â  Â 
Â  Â <header class="text-center mb-2 mt-1 shrink-0">
Â  Â  Â <h1 class="text-xl font-extrabold text-pink-600 tracking-wide cute-wiggle">ğŸŒ¸ AAFLOWERSHOP</h1>
Â  Â </header>

Â  Â <div class="glass-card rounded-2xl p-3 border-pink-100 border mb-2 shrink-0 relative z-10">
Â  Â  <div class="flex gap-2 mb-2">
Â  Â  Â  <div class="w-[70%] input-group">
Â  Â  Â  Â  <label>à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸² *</label>Â 
Â  Â  Â  Â  <input type="text" id="customer-name" class="input-field" placeholder="à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²">
Â  Â  Â  </div>
Â  Â  Â  <div class="w-[30%] input-group">
Â  Â  Â  Â  <label>à¸„à¸´à¸§à¸—à¸µà¹ˆ *</label>Â 
Â  Â  Â  Â  <input type="number" id="queue-number" class="input-field text-center" placeholder="0" inputmode="numeric">
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="grid grid-cols-12 gap-2 mb-2">
Â  Â  Â  <div class="col-span-3 input-group">
Â  Â  Â  Â  <label>à¸ˆà¸³à¸™à¸§à¸™</label>Â 
Â  Â  Â  Â  <input type="number" id="flower-count" class="input-field text-center" placeholder="1" value="1" inputmode="numeric">
Â  Â  Â  </div>
Â  Â  Â  <div class="col-span-5 input-group">
Â  Â  Â  Â  <label>à¸§à¸±à¸™à¸—à¸µà¹ˆà¸£à¸±à¸š *</label>Â 
Â  Â  Â  Â  <input type="date" id="order-date" class="input-field text-center text-xs">
Â  Â  Â  </div>
Â  Â  Â  <div class="col-span-4 input-group">
Â  Â  Â  Â  <label>à¸£à¸²à¸„à¸² (à¸¿)</label>Â 
Â  Â  Â  Â  <input type="number" id="price" class="input-field text-right" placeholder="0" inputmode="numeric">
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="flex gap-2 mb-2">
Â  Â  Â  Â  <label class="flex-1 cursor-pointer">
Â  Â  Â  Â  Â  Â  <input type="checkbox" id="addon-crown" class="addon-checkbox hidden">
Â  Â  Â  Â  Â  Â  <div class="border border-pink-200 rounded-lg py-1.5 px-2 text-center text-xs text-gray-500 font-bold transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘‘ à¸¡à¸‡à¸à¸¸à¸
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label class="flex-1 cursor-pointer">
Â  Â  Â  Â  Â  Â  <input type="checkbox" id="addon-butterfly" class="addon-checkbox hidden">
Â  Â  Â  Â  Â  Â  <div class="border border-pink-200 rounded-lg py-1.5 px-2 text-center text-xs text-gray-500 font-bold transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ¦‹ à¸œà¸µà¹€à¸ªà¸·à¹‰à¸­
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </label>
Â  Â  </div>

Â  Â  <div class="input-group mb-2">
Â  Â  Â  Â <input type="text" id="notes" class="input-field" style="background-color: #fff1f2;" placeholder="ğŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡...">
Â  Â  </div>

Â  Â  <div class="border-t border-pink-100 my-2"></div>

Â  Â  <div class="space-y-2">
Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  <span class="text-[11px] font-bold text-pink-500 w-8 shrink-0">à¸”à¸­à¸</span>
Â  Â  Â  Â  <div id="flower-colors-picker" class="flex gap-1.5 overflow-x-auto hide-scrollbar flex-1 py-1 px-1"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  <span class="text-[11px] font-bold text-purple-500 w-8 shrink-0">à¸Šà¹ˆà¸­</span>
Â  Â  Â  Â  <div id="bouquet-colors-picker" class="flex gap-1.5 overflow-x-auto hide-scrollbar flex-1 py-1 px-1"></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <button id="add-order-btn" class="mt-2 w-full bg-gradient-to-r from-pink-400 to-rose-400 text-white py-2 rounded-xl font-bold shadow-lg shadow-pink-200 active:scale-95 transition-all flex justify-center items-center gap-2 text-sm">
Â  Â  Â  <span>âœ¨ à¸šà¸±à¸™à¸—à¸¶à¸à¸­à¸­à¹€à¸”à¸­à¸£à¹Œ âœ¨</span>
Â  Â  </button>
Â  Â </div>

Â  Â <div class="glass-card rounded-xl overflow-hidden border border-pink-100 shadow-md flex-1 flex flex-col min-h-0 mb-4 relative z-10">
Â  Â  Â 
Â  Â  Â <div id="loading-overlay" class="hidden absolute inset-0 bg-white/60 flex items-center justify-center z-50 backdrop-blur-sm">
Â  Â  Â  Â <div class="text-pink-500 font-bold text-xs animate-pulse">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>
Â  Â  Â </div>

Â  Â  Â <div class="bg-pink-50/80 p-2.5 flex justify-between items-center border-b border-pink-100 shrink-0">
Â  Â  Â  Â <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â <h2 class="text-sm font-bold text-pink-700 flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â ğŸ“‹ à¸£à¸²à¸¢à¸à¸²à¸£ <span id="order-count" class="bg-white text-pink-600 px-2 py-0.5 rounded-full text-xs shadow-sm">0</span>
Â  Â  Â  Â  Â  Â </h2>
Â  Â  Â  Â  Â  Â <button id="refresh-btn" class="bg-white text-pink-500 w-6 h-6 rounded-full shadow-sm flex items-center justify-center hover:bg-pink-100 active:scale-90 transition-all" title="à¸£à¸µà¹€à¸Ÿà¸£à¸Šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹ˆà¸²à¸ªà¸¸à¸”">
Â  Â  Â  Â  Â  Â  Â ğŸ”„
Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â </div>
Â  Â  Â  Â <div id="total-revenue" class="text-green-600 font-bold text-sm bg-white px-2 py-0.5 rounded-lg shadow-sm">à¸¿0</div>
Â  Â  Â </div>

Â  Â  Â <div id="empty-state" class="flex-1 flex flex-col items-center justify-center text-center p-6 text-pink-300 hidden">
Â  Â  Â  Â  <div class="text-5xl mb-2 animate-bounce">ğŸŒ·</div>
Â  Â  Â  Â  <p class="font-light text-sm">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...</p>
Â  Â  Â </div>

Â  Â  Â <div id="table-wrapper" class="overflow-auto scrollbar-pink flex-1 hidden">
Â  Â  Â  Â <table class="custom-table w-full min-w-[600px]">
Â  Â  Â  Â  Â <thead class="sticky top-0 z-20">
Â  Â  Â  Â  Â  Â <tr>
Â  Â  Â  Â  Â  Â  Â <th class="w-[8%] text-center">à¸§à¸±à¸™à¸—à¸µà¹ˆ</th>
Â  Â  Â  Â  Â  Â  Â <th class="w-[8%] text-center">à¸„à¸´à¸§</th>
Â  Â  Â  Â  Â  Â  Â <th class="w-[28%]">à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²</th>
Â  Â  Â  Â  Â  Â  Â <th class="w-[8%] text-center">à¸ˆà¸³à¸™à¸§à¸™</th>
Â  Â  Â  Â  Â  Â  Â <th class="w-[20%]">à¸ªà¸µ (à¸”à¸­à¸/à¸Šà¹ˆà¸­)</th>Â 
Â  Â  Â  Â  Â  Â  Â <th class="w-[13%] text-right">à¸£à¸²à¸„à¸²</th>
Â  Â  Â  Â  Â  Â  Â <th class="w-[10%] text-center">à¸ˆà¹ˆà¸²à¸¢?</th>
Â  Â  Â  Â  Â  Â  Â <th class="w-[5%] text-center"></th>
Â  Â  Â  Â  Â  Â </tr>
Â  Â  Â  Â  Â </thead>
Â  Â  Â  Â  Â <tbody id="orders-list-body"></tbody>
Â  Â  Â  Â </table>
Â  Â  Â </div>
Â  Â </div>
Â  </div>

Â  <script>
Â  Â  // -----------------------------------------------------------------------
Â  Â  // âš ï¸âš ï¸ à¸§à¸²à¸‡ URL à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸ˆà¸²à¸ Google Apps Script à¸•à¸£à¸‡à¸™à¸µà¹‰ âš ï¸âš ï¸
Â  Â  // -----------------------------------------------------------------------
Â  Â  const API_URL = "https://script.google.com/macros/s/AKfycbykNWYj-Bdit4PnqxRdOGHULxrxxNmO9G1p6lDz4wkSgQH3xiXPhqKA5zJxgLWHuN8zdQ/exec";
Â  Â  // -----------------------------------------------------------------------

Â  Â  const COLOR_MAP = {
Â  Â  Â  Â  '#ef4444': 'à¹à¸”à¸‡', '#f97316': 'à¸ªà¹‰à¸¡', '#eab308': 'à¹€à¸«à¸¥à¸·à¸­à¸‡',
Â  Â  Â  Â  '#84cc16': 'à¹€à¸‚à¸µà¸¢à¸§à¸­à¹ˆà¸­à¸™', '#22c55e': 'à¹€à¸‚à¸µà¸¢à¸§', '#06b6d4': 'à¸Ÿà¹‰à¸²',
Â  Â  Â  Â  '#3b82f6': 'à¸™à¹‰à¸³à¹€à¸‡à¸´à¸™', '#a855f7': 'à¸¡à¹ˆà¸§à¸‡', '#ec4899': 'à¸Šà¸¡à¸à¸¹',
Â  Â  Â  Â  '#ffffff': 'à¸‚à¸²à¸§', '#000000': 'à¸”à¸³'
Â  Â  };
Â  Â Â 
Â  Â  const flowerColors = Object.keys(COLOR_MAP);
Â  Â  const bouquetColors = ['#ec4899', '#ef4444', '#ffffff', '#000000', '#3b82f6', '#eab308', '#a855f7'];

Â  Â  let state = { fColors: [], bColors: [] };
Â  Â  let orders = [];

Â  Â  window.onload = function() {
Â  Â  Â  Â  createFallingFlowers();
Â  Â  Â  Â  renderColorPickers();
Â  Â  Â  Â  document.getElementById('order-date').valueAsDate = new Date();
Â  Â  Â  Â  document.getElementById('add-order-btn').onclick = handleAdd;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // à¸œà¸¹à¸à¸›à¸¸à¹ˆà¸¡à¸£à¸µà¹€à¸Ÿà¸£à¸Š
Â  Â  Â  Â  document.getElementById('refresh-btn').onclick = () => {
Â  Â  Â  Â  Â  Â  document.getElementById('refresh-btn').classList.add('spin-anim');
Â  Â  Â  Â  Â  Â  setTimeout(() => document.getElementById('refresh-btn').classList.remove('spin-anim'), 800);
Â  Â  Â  Â  Â  Â  fetchData(); // à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆ
Â  Â  Â  Â  };

Â  Â  Â  Â  fetchData();
Â  Â  };

Â  Â  // --- à¸­à¹ˆà¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ ---
Â  Â  async function fetchData() {
Â  Â  Â  Â  const loader = document.getElementById('loading-overlay');
Â  Â  Â  Â  const empty = document.getElementById('empty-state');
Â  Â  Â  Â  const table = document.getElementById('table-wrapper');
Â  Â  Â  Â Â 
Â  Â  Â  Â  loader.classList.remove('hidden');
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(API_URL + "?action=read");
Â  Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  Â  orders = data; // à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡ reverse à¸—à¸µà¹ˆà¸™à¸µà¹ˆà¹à¸¥à¹‰à¸§ à¹€à¸”à¸µà¹‹à¸¢à¸§à¹„à¸› sort à¸•à¸­à¸™ render
Â  Â  Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  loader.classList.add('hidden');
Â  Â  Â  Â  Â  Â  empty.classList.add('hidden');
Â  Â  Â  Â  Â  Â  table.classList.remove('hidden');
Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  loader.classList.add('hidden');
Â  Â  Â  Â  Â  Â  empty.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.querySelector('#empty-state p').innerText = "à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸¡à¹ˆà¹„à¸”à¹‰ à¸¥à¸­à¸‡à¸£à¸µà¹€à¸Ÿà¸£à¸Šà¹ƒà¸«à¸¡à¹ˆ";
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ ---
Â  Â  function handleAdd() {
Â  Â  Â  Â  const name = document.getElementById('customer-name').value;
Â  Â  Â  Â  const price = document.getElementById('price').value;
Â  Â  Â  Â  const dateVal = document.getElementById('order-date').value;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!name) { alert('âš ï¸ à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²à¸à¹ˆà¸­à¸™à¸™à¸°'); return; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const btn = document.getElementById('add-order-btn');
Â  Â  Â  Â  btn.innerHTML = 'â³ à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡...';
Â  Â  Â  Â  btn.disabled = true;

Â  Â  Â  Â  const hasCrown = document.getElementById('addon-crown').checked;
Â  Â  Â  Â  const hasButterfly = document.getElementById('addon-butterfly').checked;
Â  Â  Â  Â  let noteText = document.getElementById('notes').value;
Â  Â  Â  Â  let addons = [];

Â  Â  Â  Â  if(hasCrown) addons.push("à¸¡à¸‡à¸à¸¸à¸");
Â  Â  Â  Â  if(hasButterfly) addons.push("à¸œà¸µà¹€à¸ªà¸·à¹‰à¸­");

Â  Â  Â  Â  if(addons.length > 0) {
Â  Â  Â  Â  Â  Â  const addonString = "[à¹€à¸à¸´à¹ˆà¸¡: " + addons.join(" + ") + "]";
Â  Â  Â  Â  Â  Â  if(noteText) noteText = noteText + " " + addonString;
Â  Â  Â  Â  Â  Â  else noteText = addonString;
Â  Â  Â  Â  }

Â  Â  Â  Â  const newItem = {
Â  Â  Â  Â  Â  Â  id: 'id_' + Date.now(),
Â  Â  Â  Â  Â  Â  customer_name: name,
Â  Â  Â  Â  Â  Â  queue_number: document.getElementById('queue-number').value || '0', // à¸à¸±à¸™à¹€à¸›à¹‡à¸™ null
Â  Â  Â  Â  Â  Â  flower_count: document.getElementById('flower-count').value || '1',
Â  Â  Â  Â  Â  Â  order_date: dateVal,
Â  Â  Â  Â  Â  Â  price: price || '0',
Â  Â  Â  Â  Â  Â  notes: noteText,Â 
Â  Â  Â  Â  Â  Â  flower_colors: state.fColors.map(c => COLOR_MAP[c] || c).join(', '),
Â  Â  Â  Â  Â  Â  bouquet_colors: state.bColors.map(c => COLOR_MAP[c] || c).join(', '),
Â  Â  Â  Â  Â  Â  is_paid: false
Â  Â  Â  Â  };

Â  Â  Â  Â  orders.push(newItem); // à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹„à¸›
Â  Â  Â  Â  renderTable(); // à¸•à¸²à¸£à¸²à¸‡à¸ˆà¸°à¹€à¸£à¸µà¸¢à¸‡à¹€à¸¥à¸‚à¹€à¸­à¸‡à¸—à¸µà¹ˆà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸™à¸µà¹‰
Â  Â  Â  Â  resetForm();
Â  Â  Â  Â Â 
Â  Â  Â  Â  btn.innerHTML = 'âœ… à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢!';
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  btn.innerHTML = 'âœ¨ à¸šà¸±à¸™à¸—à¸¶à¸à¸­à¸­à¹€à¸”à¸­à¸£à¹Œ âœ¨';
Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  }, 1500);

Â  Â  Â  Â  fetch(API_URL + "?action=create", {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  mode: 'no-cors',
Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "text/plain" },
Â  Â  Â  Â  Â  Â  body: JSON.stringify(newItem)
Â  Â  Â  Â  }).catch(e => console.error("Error saving:", e));
Â  Â  }

Â  Â  // --- à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ ---
Â  Â  function handleDelete(id) {
Â  Â  Â  Â  if(!confirm('à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¹„à¸«à¸¡?')) return;
Â  Â  Â  Â  orders = orders.filter(o => o.id !== id);
Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  fetch(API_URL + "?action=delete&id=" + id, { method: 'POST', mode: 'no-cors' });
Â  Â  }

Â  Â  // --- à¸­à¸±à¸›à¹€à¸”à¸•à¸ˆà¹ˆà¸²à¸¢à¹€à¸‡à¸´à¸™ ---
Â  Â  function togglePaid(id, isPaid) {
Â  Â  Â  Â  const item = orders.find(o => o.id == id);
Â  Â  Â  Â  if (item) item.is_paid = isPaid;
Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  fetch(API_URL + "?action=update", {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  mode: 'no-cors',
Â  Â  Â  Â  Â  Â  body: JSON.stringify({ id: id, is_paid: isPaid })
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- à¹à¸ªà¸”à¸‡à¸œà¸¥à¸•à¸²à¸£à¸²à¸‡ (à¹à¸à¹‰à¹ƒà¸«à¹‰à¹€à¸£à¸µà¸¢à¸‡à¸•à¸²à¸¡à¸„à¸´à¸§) ---
Â  Â  function renderTable() {
Â  Â  Â  Â  const tbody = document.getElementById('orders-list-body');
Â  Â  Â  Â  tbody.innerHTML = '';
Â  Â  Â  Â  let total = 0;

Â  Â  Â  Â  // ğŸ”¥ à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸²à¸¡à¹€à¸¥à¸‚à¸„à¸´à¸§ (à¸™à¹‰à¸­à¸¢à¹„à¸›à¸¡à¸²à¸) ğŸ”¥
Â  Â  Â  Â  orders.sort((a, b) => {
Â  Â  Â  Â  Â  Â  const queueA = parseInt(a.queue_number) || 0;
Â  Â  Â  Â  Â  Â  const queueB = parseInt(b.queue_number) || 0;
Â  Â  Â  Â  Â  Â  return queueA - queueB;
Â  Â  Â  Â  });

Â  Â  Â  Â  orders.forEach(order => {
Â  Â  Â  Â  Â  Â  if (!order.is_paid) total += parseFloat(order.price) || 0;

Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  tr.className = 'pop-row hover:bg-white/50 transition-colors';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const fDots = getDots(order.flower_colors);
Â  Â  Â  Â  Â  Â  const bDots = getDots(order.bouquet_colors);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let dateDisplay = "-";
Â  Â  Â  Â  Â  Â  if(order.order_date) {
Â  Â  Â  Â  Â  Â  Â  Â  const d = new Date(order.order_date);
Â  Â  Â  Â  Â  Â  Â  Â  if(!isNaN(d)) dateDisplay = d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
Â  Â  Â  Â  Â  Â  Â  Â  else dateDisplay = order.order_date;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <td class="text-center text-xs font-bold text-gray-500">${dateDisplay}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="text-center font-bold text-pink-600">${order.queue_number}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-gray-700 text-sm">${order.customer_name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${order.notes ? `<div class="text-[10px] text-pink-500 font-medium truncate max-w-[140px]">${order.notes}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="text-center"><span class="bg-pink-100 text-pink-700 px-2 py-0.5 rounded text-xs font-bold">${order.flower_count}</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-1 text-[10px] text-gray-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="text-pink-400 font-bold">à¸”:</span> <div class="flex gap-0.5 flex-wrap">${fDots || '-'}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-1 text-[10px] text-gray-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="text-purple-400 font-bold">à¸Š:</span> <div class="flex gap-0.5 flex-wrap">${bDots || '-'}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="text-right font-bold text-gray-600">${Number(order.price).toLocaleString()}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="tgl-wrap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="tgl-inp"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${order.is_paid ? 'checked' : ''}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onchange="togglePaid('${order.id}', this.checked)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="tgl-bg"><span class="tgl-ball"></span></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="handleDelete('${order.id}')" class="text-red-300 hover:text-red-500 text-lg transition-colors">Ã—</button>
Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('order-count').innerText = orders.length;
Â  Â  Â  Â  document.getElementById('total-revenue').innerText = 'à¸¿' + total.toLocaleString();
Â  Â  }

Â  Â  function getDots(colorString) {
Â  Â  Â  Â  if(!colorString) return '';
Â  Â  Â  Â  const reverseMap = {};
Â  Â  Â  Â  for(let k in COLOR_MAP) reverseMap[COLOR_MAP[k]] = k;

Â  Â  Â  Â  return colorString.split(', ').map(c => {
Â  Â  Â  Â  Â  Â  const hex = reverseMap[c] || c;Â 
Â  Â  Â  Â  Â  Â  if(hex.startsWith('#')) {
Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="w-2.5 h-2.5 rounded-full border border-gray-300 shadow-sm" style="background-color: ${hex};" title="${c}"></div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return `<span>${c}</span>`;
Â  Â  Â  Â  }).join('');
Â  Â  }

Â  Â  function resetForm() {
Â  Â  Â  Â  document.getElementById('customer-name').value = '';
Â  Â  Â  Â  document.getElementById('price').value = '';
Â  Â  Â  Â  document.getElementById('notes').value = '';
Â  Â  Â  Â  document.getElementById('addon-crown').checked = false;
Â  Â  Â  Â  document.getElementById('addon-butterfly').checked = false;
Â  Â  Â  Â  document.getElementById('customer-name').focus();
Â  Â  }

Â  Â  function renderColorPickers() {
Â  Â  Â  Â  const render = (colors, elId, type) => {
Â  Â  Â  Â  Â  Â  const el = document.getElementById(elId);
Â  Â  Â  Â  Â  Â  el.innerHTML = '';
Â  Â  Â  Â  Â  Â  colors.forEach(c => {
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  btn.className = 'color-btn transition-all duration-200';
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.backgroundColor = c;
Â  Â  Â  Â  Â  Â  Â  Â  btn.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const arr = type === 'f' ? state.fColors : state.bColors;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const idx = arr.indexOf(c);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (idx > -1) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  arr.splice(idx, 1);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('selected', 'scale-110');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  arr.push(c);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('selected', 'scale-110');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  el.appendChild(btn);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };
Â  Â  Â  Â  render(flowerColors, 'flower-colors-picker', 'f');
Â  Â  Â  Â  render(bouquetColors, 'bouquet-colors-picker', 'b');
Â  Â  }

Â  Â  function createFallingFlowers() {
Â  Â  Â  Â  const container = document.getElementById('falling-container');
Â  Â  Â  Â  const emojis = ['ğŸŒ¸', 'ğŸŒ¹', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸ’'];
Â  Â  Â  Â  for (let i = 0; i < 15; i++) {
Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  el.className = 'falling-item';
Â  Â  Â  Â  Â  Â  el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
Â  Â  Â  Â  Â  Â  el.style.left = Math.random() * 100 + '%';
Â  Â  Â  Â  Â  Â  el.style.animationDuration = (Math.random() * 5 + 5) + 's';
Â  Â  Â  Â  Â  Â  el.style.animationDelay = (Math.random() * 5) + 's';
Â  Â  Â  Â  Â  Â  el.style.fontSize = (Math.random() * 20 + 10) + 'px';
Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  }
Â  Â  }
Â  </script>
Â </body>
</html> 
