<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AAFLOWERSHOP - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    body { box-sizing: border-box; overflow: hidden; }
    * { font-family: 'Kanit','Prompt',sans-serif; }

    #falling-container{
      position:fixed; inset:0; pointer-events:none; z-index:-1;
      background:linear-gradient(180deg,#fff0f5,#ffe4e6);
    }
    .spinner{
      border:3px solid rgba(236,72,153,.3);
      border-top:3px solid #db2777;
      border-radius:50%;
      width:20px;height:20px;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    #loading-overlay{
      position:absolute; inset:0;
      background:rgba(255,255,255,.6);
      backdrop-filter:blur(2px);
      z-index:50;
      display:flex;
      align-items:center;
      justify-content:center;
    }
  </style>
</head>

<body class="h-full">

<div id="falling-container"></div>

<div class="h-full w-full p-3 max-w-xl mx-auto flex flex-col relative">

  <h1 class="text-2xl font-extrabold text-pink-600 text-center mb-3">
    üå∏ AAFLOWERSHOP
  </h1>

  <!-- TABLE CARD -->
  <div class="bg-white/80 rounded-xl border border-pink-100 shadow flex-1 flex flex-col relative overflow-hidden">

    <!-- loading -->
    <div id="loading-overlay" class="hidden">
      <div class="flex flex-col items-center gap-2 text-pink-500 text-xs font-bold">
        <div class="spinner"></div>
        <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
      </div>
    </div>

    <div class="p-2 flex justify-between items-center border-b border-pink-100 bg-pink-50">
      <div class="font-bold text-pink-700 text-sm">
        üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        <span id="order-count" class="ml-1 bg-white px-2 rounded-full text-xs">0</span>
      </div>
      <div id="total-revenue" class="font-bold text-green-600 text-sm">‡∏ø0</div>
    </div>

    <div id="empty-state" class="flex-1 flex flex-col items-center justify-center text-pink-300">
      <div class="text-5xl mb-2">üå∑</div>
      <p class="text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <div id="table-wrapper" class="flex-1 overflow-auto hidden">
      <table class="w-full text-sm">
        <thead class="sticky top-0 bg-white">
          <tr class="border-b">
            <th class="p-2 text-center">‡∏Ñ‡∏¥‡∏ß</th>
            <th class="p-2">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
            <th class="p-2 text-right">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
          </tr>
        </thead>
        <tbody id="orders-list-body"></tbody>
      </table>
    </div>

  </div>
</div>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbxIrAI31xYNrCboyNNoOBDxA1k3n7WZzKn9Hg-sYLmReAZ7K58MTbIVaHi-xFRhL2oE/exec";
let orders = [];

/* ===== INIT ===== */
document.addEventListener("DOMContentLoaded", () => {
  fetchOrders();
});

/* ===== UI ===== */
function showLoading(show){
  document.getElementById("loading-overlay")
    .classList.toggle("hidden", !show);
}

function showEmpty(msg){
  document.getElementById("empty-state").classList.remove("hidden");
  document.getElementById("empty-state").querySelector("p").innerHTML = msg;
  document.getElementById("table-wrapper").classList.add("hidden");
}

function hideEmpty(){
  document.getElementById("empty-state").classList.add("hidden");
}

/* ===== FETCH ===== */
async function fetchOrders(){
  showLoading(true);
  showEmpty("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");

  try{
    const res = await fetch(API_URL,{cache:"no-store"});
    const data = await res.json();

    orders = Array.isArray(data) ? data : [];
    renderTable();
  }catch(err){
    console.error(err);
    showEmpty("‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<br>‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÉ‡∏´‡∏°‡πà");
  }finally{
    showLoading(false); // üî• ‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
  }
}

/* ===== RENDER ===== */
function renderTable(){
  const tbody = document.getElementById("orders-list-body");

  if(orders.length === 0){
    showEmpty("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡πâ‡∏≤ üå∏");
    document.getElementById("order-count").innerText = 0;
    document.getElementById("total-revenue").innerText = "‡∏ø0";
    return;
  }

  hideEmpty();
  document.getElementById("table-wrapper").classList.remove("hidden");

  document.getElementById("order-count").innerText = orders.length;
  document.getElementById("total-revenue").innerText =
    "‡∏ø" + orders.reduce((s,o)=>s+(Number(o.price)||0),0).toLocaleString();

  tbody.innerHTML = "";
  orders.forEach(o=>{
    const tr = document.createElement("tr");
    tr.className = "border-b";
    tr.innerHTML = `
      <td class="p-2 text-center">${o.queue_number||"-"}</td>
      <td class="p-2">${o.customer_name||""}</td>
      <td class="p-2 text-right text-green-600 font-bold">‡∏ø${o.price||0}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>
