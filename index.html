<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AAFLOWERSHOP - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&amp;family=Prompt:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; }
    * { font-family: 'Kanit', 'Prompt', sans-serif; }
    
    @keyframes bounce-in {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(236, 72, 153, 0.3); }
      50% { box-shadow: 0 0 20px rgba(236, 72, 153, 0.6); }
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }
    
    .bounce-in { animation: bounce-in 0.6s ease-out; }
    .float { animation: float 3s ease-in-out infinite; }
    .shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }
    .shake { animation: shake 0.5s ease-in-out; }
    .fade-in { animation: fade-in 0.5s ease-out; }
    .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
    
    .color-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      margin: 2px;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .color-picker-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: 3px solid transparent;
    }
    
    .color-picker-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .color-picker-btn.selected {
      border-color: #ec4899;
      transform: scale(1.1);
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.3);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 25%, #fbcfe8 50%, #f9a8d4 75%, #f472b6 100%);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      transition: all 0.3s;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #db2777 0%, #be185d 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(236, 72, 153, 0.4);
    }
    
    .input-field {
      transition: all 0.3s;
      border: 2px solid #f9a8d4;
    }
    
    .input-field:focus {
      border-color: #ec4899;
      box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.15);
      outline: none;
    }
    
    .table-row {
      transition: all 0.3s;
    }
    
    .table-row:hover {
      background: rgba(252, 231, 243, 0.5);
      transform: scale(1.01);
    }
    
    .checkbox-cute {
      appearance: none;
      width: 24px;
      height: 24px;
      border: 3px solid #f472b6;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    
    .checkbox-cute:checked {
      background: linear-gradient(135deg, #ec4899, #db2777);
      border-color: #db2777;
    }
    
    .checkbox-cute:checked::after {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      font-size: 14px;
    }
    
    .warning-toast {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-left: 4px solid #f59e0b;
    }
    
    .petal {
      position: absolute;
      width: 15px;
      height: 15px;
      background: #f9a8d4;
      border-radius: 50% 0 50% 50%;
      opacity: 0.6;
      pointer-events: none;
    }
    
    .scrollbar-pink::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .scrollbar-pink::-webkit-scrollbar-track {
      background: #fce7f3;
      border-radius: 10px;
    }
    
    .scrollbar-pink::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #f472b6, #ec4899);
      border-radius: 10px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg scrollbar-pink overflow-auto">
  <div id="app" class="min-h-full w-full p-4 md:p-6"><div class="fixed inset-0 overflow-hidden pointer-events-none" id="petals-container"></div><header class="text-center mb-6 bounce-in relative">
    <div class="inline-block">
     <h1 id="shop-title" class="text-3xl md:text-5xl font-bold text-pink-600 float">üå∏ AAFLOWERSHOP üå∏</h1>
     <p id="shop-subtitle" class="text-pink-400 mt-2 text-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ</p>
    </div>
    <div class="absolute -top-2 -left-2 text-4xl sparkle">
     ‚ú®
    </div>
    <div class="absolute -top-2 -right-2 text-4xl sparkle" style="animation-delay: 0.5s;">
     ‚ú®
    </div>
   </header><div id="warning-toast" class="fixed top-4 left-1/2 transform -translate-x-1/2 warning-toast px-6 py-3 rounded-xl shadow-lg z-50 hidden">
    <div class="flex items-center gap-2"><span class="text-2xl">‚ö†Ô∏è</span> <span class="font-medium text-amber-800">‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!</span>
    </div>
   </div><div id="form-container" class="glass-card rounded-3xl p-4 md:p-6 mb-6 shadow-xl fade-in max-w-4xl mx-auto">
    <h2 class="text-xl md:text-2xl font-semibold text-pink-600 mb-4 flex items-center gap-2"><span class="text-2xl">üíê</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><div><label class="block text-pink-600 font-medium mb-1 text-sm">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ *</label> <input type="text" id="customer-name" class="input-field w-full px-4 py-2 rounded-xl bg-white/80 text-gray-700" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
     </div><div><label class="block text-pink-600 font-medium mb-1 text-sm">üå∑ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≠‡∏Å *</label> <input type="number" id="flower-count" class="input-field w-full px-4 py-2 rounded-xl bg-white/80 text-gray-700" placeholder="0" min="1">
     </div><div><label class="block text-pink-600 font-medium mb-1 text-sm">üé´ ‡∏Ñ‡∏¥‡∏ß *</label> <input type="number" id="queue-number" class="input-field w-full px-4 py-2 rounded-xl bg-white/80 text-gray-700" placeholder="0" min="1">
     </div><div><label class="block text-pink-600 font-medium mb-1 text-sm">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà *</label> <input type="date" id="order-date" class="input-field w-full px-4 py-2 rounded-xl bg-white/80 text-gray-700">
     </div><div><label class="block text-pink-600 font-medium mb-1 text-sm">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó) *</label> <input type="number" id="price" class="input-field w-full px-4 py-2 rounded-xl bg-white/80 text-gray-700" placeholder="0" min="0">
     </div><div><label class="block text-pink-600 font-medium mb-1 text-sm">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <input type="text" id="notes" class="input-field w-full px-4 py-2 rounded-xl bg-white/80 text-gray-700" placeholder="‡∏≠‡∏∑‡πà‡∏ô‡πÜ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
     </div>
    </div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"><div class="bg-purple-100/50 rounded-2xl p-4 border-2 border-purple-200"><label class="block text-purple-600 font-semibold mb-2 text-sm flex items-center gap-2"> <span class="text-xl">üå∏</span> ‡∏™‡∏µ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏µ) </label>
      <div id="flower-colors-picker" class="grid grid-cols-8 gap-2 mb-2"></div>
      <div class="flex flex-wrap gap-1 mt-2 min-h-[30px] bg-white/50 rounded-lg p-2" id="selected-flower-colors"><span class="text-purple-400 text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ</span>
      </div>
     </div><div class="bg-purple-100/50 rounded-2xl p-4 border-2 border-purple-200"><label class="block text-purple-600 font-semibold mb-2 text-sm flex items-center gap-2"> <span class="text-xl">üíê</span> ‡∏™‡∏µ‡∏ä‡πà‡∏≠‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏µ) </label>
      <div id="bouquet-colors-picker" class="grid grid-cols-8 gap-2 mb-2"></div>
      <div class="flex flex-wrap gap-1 mt-2 min-h-[30px] bg-white/50 rounded-lg p-2" id="selected-bouquet-colors"><span class="text-purple-400 text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ</span>
      </div>
     </div>
    </div><div class="mt-6 text-center"><button id="add-order-btn" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold text-lg pulse-glow"> ‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‚ú® </button>
    </div>
   </div><div class="glass-card rounded-3xl p-4 md:p-6 shadow-xl fade-in max-w-6xl mx-auto overflow-hidden">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2">
     <h2 class="text-xl md:text-2xl font-semibold text-pink-600 flex items-center gap-2"><span class="text-2xl">üìã</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
     <div class="flex items-center gap-2"><span id="order-count" class="bg-pink-200 text-pink-700 px-3 py-1 rounded-full text-sm font-medium">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span> <span id="total-revenue" class="bg-green-200 text-green-700 px-3 py-1 rounded-full text-sm font-medium">‡∏ø0</span>
     </div>
    </div>
    <div class="overflow-x-auto scrollbar-pink">
     <table class="w-full min-w-[900px]">
      <thead>
       <tr class="bg-gradient-to-r from-pink-200 to-pink-300 text-pink-700">
        <th class="px-3 py-3 rounded-tl-xl text-left text-sm">‡∏Ñ‡∏¥‡∏ß</th>
        <th class="px-3 py-3 text-left text-sm">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
        <th class="px-3 py-3 text-center text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        <th class="px-3 py-3 text-center text-sm">‡∏™‡∏µ‡∏î‡∏≠‡∏Å</th>
        <th class="px-3 py-3 text-center text-sm">‡∏™‡∏µ‡∏ä‡πà‡∏≠</th>
        <th class="px-3 py-3 text-center text-sm">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
        <th class="px-3 py-3 text-right text-sm">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
        <th class="px-3 py-3 text-left text-sm">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th class="px-3 py-3 text-center text-sm">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</th>
        <th class="px-3 py-3 rounded-tr-xl text-center text-sm">‡∏•‡∏ö</th>
       </tr>
      </thead>
      <tbody id="orders-table-body">
       <tr>
        <td colspan="10" class="text-center py-8 text-pink-400">
         <div class="text-4xl mb-2">
          üå∑
         </div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div><div id="delete-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-card rounded-3xl p-6 max-w-sm w-full bounce-in">
     <div class="text-center">
      <div class="text-5xl mb-4">
       üóëÔ∏è
      </div>
      <h3 class="text-xl font-semibold text-pink-600 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?</h3>
      <p class="text-gray-600 mb-4">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
      <div class="flex gap-3 justify-center"><button id="cancel-delete-btn" class="px-6 py-2 rounded-xl bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-all"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button id="confirm-delete-btn" class="px-6 py-2 rounded-xl bg-red-500 text-white font-medium hover:bg-red-600 transition-all"> ‡∏•‡∏ö‡πÄ‡∏•‡∏¢ </button>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // --- MOCK SDK (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö Local) ---
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ SDK ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á
    if (!window.dataSdk) {
      console.warn("‚ö†Ô∏è Running with Mock SDK (Data will be lost on refresh)");
      window.dataSdk = {
        init: async (handler) => { 
          window._mockHandler = handler; 
          return { isOk: true }; 
        },
        create: async (data) => {
          // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£ delay ‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢
          await new Promise(r => setTimeout(r, 500));
          return { isOk: true };
        },
        update: async (data) => { return { isOk: true }; },
        delete: async (data) => { return { isOk: true }; }
      };
    }

    // Color palette for pickers
    const colorPalette = [
      // Reds & Pinks
      '#FF0000', '#FF4444', '#FF6B6B', '#FF8888', '#FFAAAA',
      '#FF1493', '#FF69B4', '#FFB6C1', '#FFC0CB', '#FFE4E1',
      // Oranges & Yellows
      '#FF4500', '#FF6347', '#FF7F50', '#FFA500', '#FFD700',
      '#FFFF00', '#FFFFE0', '#FFFACD', '#FFEFD5', '#FFE4B5',
      // Greens
      '#00FF00', '#32CD32', '#90EE90', '#98FB98', '#00FA9A',
      '#2E8B57', '#3CB371', '#66CDAA', '#8FBC8F', '#9ACD32',
      // Blues & Cyans
      '#00FFFF', '#00CED1', '#40E0D0', '#48D1CC', '#7FFFD4',
      '#0000FF', '#4169E1', '#6495ED', '#87CEEB', '#ADD8E6',
      // Purples & Violets
      '#8B00FF', '#9400D3', '#9932CC', '#BA55D3', '#DA70D6',
      '#EE82EE', '#DDA0DD', '#E6E6FA', '#D8BFD8', '#C8A2C8',
      // Browns & Neutrals
      '#8B4513', '#A0522D', '#CD853F', '#D2691E', '#DEB887',
      '#F5DEB3', '#FAEBD7', '#FAF0E6', '#FFF8DC', '#FFFAF0',
      // Whites, Grays & Blacks
      '#FFFFFF', '#F5F5F5', '#DCDCDC', '#C0C0C0', '#A9A9A9',
      '#808080', '#696969', '#505050', '#303030', '#000000',
    ];
    
    // State
    let orders = [];
    let selectedFlowerColors = [];
    let selectedBouquetColors = [];
    let pendingDeleteRecord = null;
    let isLoading = false;
    
    // Default config
    const defaultConfig = {
      shop_name: 'AAFLOWERSHOP',
      subtitle_text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ',
      primary_color: '#EC4899',
      secondary_color: '#F9A8D4',
      background_color: '#FDF2F8',
      text_color: '#831843',
      accent_color: '#DB2777'
    };
    
    let config = { ...defaultConfig };
    
    // Initialize color pickers
    function initColorPickers() {
      const flowerPicker = document.getElementById('flower-colors-picker');
      const bouquetPicker = document.getElementById('bouquet-colors-picker');
      
      colorPalette.forEach(color => {
        // Flower color button
        const flowerBtn = document.createElement('button');
        flowerBtn.type = 'button';
        flowerBtn.className = 'color-picker-btn';
        flowerBtn.style.backgroundColor = color;
        flowerBtn.dataset.color = color;
        flowerBtn.onclick = () => toggleFlowerColor(color, flowerBtn);
        flowerPicker.appendChild(flowerBtn);
        
        // Bouquet color button
        const bouquetBtn = document.createElement('button');
        bouquetBtn.type = 'button';
        bouquetBtn.className = 'color-picker-btn';
        bouquetBtn.style.backgroundColor = color;
        bouquetBtn.dataset.color = color;
        bouquetBtn.onclick = () => toggleBouquetColor(color, bouquetBtn);
        bouquetPicker.appendChild(bouquetBtn);
      });
    }
    
    function toggleFlowerColor(color, btn) {
      const index = selectedFlowerColors.indexOf(color);
      if (index > -1) {
        selectedFlowerColors.splice(index, 1);
        btn.classList.remove('selected');
      } else {
        selectedFlowerColors.push(color);
        btn.classList.add('selected');
      }
      updateSelectedColorsDisplay('flower');
    }
    
    function toggleBouquetColor(color, btn) {
      const index = selectedBouquetColors.indexOf(color);
      if (index > -1) {
        selectedBouquetColors.splice(index, 1);
        btn.classList.remove('selected');
      } else {
        selectedBouquetColors.push(color);
        btn.classList.add('selected');
      }
      updateSelectedColorsDisplay('bouquet');
    }
    
    function updateSelectedColorsDisplay(type) {
      const container = document.getElementById(type === 'flower' ? 'selected-flower-colors' : 'selected-bouquet-colors');
      const colors = type === 'flower' ? selectedFlowerColors : selectedBouquetColors;
      
      if (colors.length === 0) {
        container.innerHTML = `<span class="text-purple-400 text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ</span>`;
      } else {
        container.innerHTML = colors.map(c => 
          `<span class="color-dot" style="background-color: ${c};" title="${c}"></span>`
        ).join('');
      }
    }
    
    function renderColorDots(colorsString) {
      if (!colorsString) return '<span class="text-gray-400 text-xs">-</span>';
      const colors = colorsString.split(',').filter(c => c);
      if (colors.length === 0) return '<span class="text-gray-400 text-xs">-</span>';
      return colors.map(c => 
        `<span class="color-dot" style="background-color: ${c};" title="${c}"></span>`
      ).join('');
    }
    
    function showWarning() {
      const toast = document.getElementById('warning-toast');
      const formContainer = document.getElementById('form-container');
      
      toast.classList.remove('hidden');
      formContainer.classList.add('shake');
      
      setTimeout(() => {
        toast.classList.add('hidden');
        formContainer.classList.remove('shake');
      }, 2000);
    }
    
    function validateForm() {
      const name = document.getElementById('customer-name').value.trim();
      const count = document.getElementById('flower-count').value;
      const queue = document.getElementById('queue-number').value;
      const date = document.getElementById('order-date').value;
      const price = document.getElementById('price').value;
      
      return name && count && queue && date && price;
    }
    
    function clearForm() {
      document.getElementById('customer-name').value = '';
      document.getElementById('flower-count').value = '';
      document.getElementById('queue-number').value = '';
      document.getElementById('order-date').value = '';
      document.getElementById('price').value = '';
      document.getElementById('notes').value = '';
      
      // Clear color selections
      selectedFlowerColors = [];
      selectedBouquetColors = [];
      
      document.querySelectorAll('#flower-colors-picker .color-picker-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      document.querySelectorAll('#bouquet-colors-picker .color-picker-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      updateSelectedColorsDisplay('flower');
      updateSelectedColorsDisplay('bouquet');
      
      // Set default date again
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('order-date').value = today;
    }
    
    async function addOrder() {
      if (isLoading) return;
      
      if (!validateForm()) {
        showWarning();
        return;
      }
      
      if (orders.length >= 999) {
        const toast = document.getElementById('warning-toast');
        toast.querySelector('span:last-child').textContent = '‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß!';
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 2000);
        return;
      }
      
      const orderData = {
        customer_name: document.getElementById('customer-name').value.trim(),
        flower_count: parseInt(document.getElementById('flower-count').value),
        flower_colors: selectedFlowerColors.join(','),
        bouquet_colors: selectedBouquetColors.join(','),
        order_date: document.getElementById('order-date').value,
        price: parseFloat(document.getElementById('price').value),
        notes: document.getElementById('notes').value.trim(),
        queue_number: parseInt(document.getElementById('queue-number').value),
        is_paid: false,
        created_at: new Date().toISOString()
      };
      
      isLoading = true;
      const btn = document.getElementById('add-order-btn');
      btn.disabled = true;
      btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      
      try {
        const result = await window.dataSdk.create(orderData);
        
        isLoading = false;
        btn.disabled = false;
        btn.innerHTML = '‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‚ú®';
        
        if (result.isOk) {
          // --- FIX: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Optimistic UI) ---
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
          const tempOrder = { 
            ...orderData, 
            __backendId: 'temp_' + Date.now() 
          };
          orders.push(tempOrder);
          renderOrders(orders); // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
          
          clearForm();
        } else {
          showWarning();
        }
      } catch (e) {
        console.error(e);
        isLoading = false;
        btn.disabled = false;
        btn.innerHTML = '‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‚ú®';
        showWarning();
      }
    }
    
    async function togglePaid(record) {
      if (isLoading) return;
      
      // Toggle local state immediately
      record.is_paid = !record.is_paid;
      renderOrders(orders);

      isLoading = true;
      try {
        await window.dataSdk.update(record);
      } catch(e) {
        // Revert if failed
        record.is_paid = !record.is_paid;
        renderOrders(orders);
      }
      isLoading = false;
    }
    
    function showDeleteModal(record) {
      pendingDeleteRecord = record;
      document.getElementById('delete-modal').classList.remove('hidden');
    }
    
    function hideDeleteModal() {
      pendingDeleteRecord = null;
      document.getElementById('delete-modal').classList.add('hidden');
    }
    
    async function confirmDelete() {
      if (!pendingDeleteRecord || isLoading) return;
      
      isLoading = true;
      const btn = document.getElementById('confirm-delete-btn');
      btn.disabled = true;
      btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...';
      
      try {
        await window.dataSdk.delete(pendingDeleteRecord);
        
        // Remove locally
        orders = orders.filter(o => o.__backendId !== pendingDeleteRecord.__backendId);
        renderOrders(orders);
      } catch(e) {
        console.error(e);
      }
      
      isLoading = false;
      btn.disabled = false;
      btn.textContent = '‡∏•‡∏ö‡πÄ‡∏•‡∏¢';
      hideDeleteModal();
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return '-';
      const date = new Date(dateStr);
      return date.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
    }
    
    function formatPrice(price) {
      return new Intl.NumberFormat('th-TH').format(price || 0);
    }
    
    function renderOrders(data) {
      const tbody = document.getElementById('orders-table-body');
      const countEl = document.getElementById('order-count');
      const revenueEl = document.getElementById('total-revenue');
      
      // Sort by queue number
      const sortedData = [...data].sort((a, b) => (a.queue_number || 0) - (b.queue_number || 0));
      
      // Update stats
      countEl.textContent = `${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      const totalRevenue = data.reduce((sum, o) => sum + (o.price || 0), 0);
      revenueEl.textContent = `‡∏ø${formatPrice(totalRevenue)}`;
      
      if (sortedData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="10" class="text-center py-8 text-pink-400">
              <div class="text-4xl mb-2">üå∑</div>
              <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
            </td>
          </tr>
        `;
        return;
      }
      
      // Clear table and rebuild (Simpler and less buggy for this use case)
      tbody.innerHTML = '';
      
      sortedData.forEach((order, index) => {
        // --- FIX: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ID ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡∏õ‡∏•‡∏≠‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ ---
        const id = order.__backendId || ('temp_id_' + index + '_' + Date.now());
        
        const row = document.createElement('tr');
        row.dataset.id = id;
        row.className = `table-row ${index % 2 === 0 ? 'bg-white/30' : 'bg-pink-50/30'} fade-in`;
        
        row.innerHTML = `
          <td class="px-3 py-3 text-center">
            <span class="bg-pink-200 text-pink-700 px-2 py-1 rounded-full text-sm font-bold">${order.queue_number || '-'}</span>
          </td>
          <td class="px-3 py-3 font-medium text-gray-700">${order.customer_name || '-'}</td>
          <td class="px-3 py-3 text-center text-gray-600">${order.flower_count || 0}</td>
          <td class="px-3 py-3 text-center">${renderColorDots(order.flower_colors)}</td>
          <td class="px-3 py-3 text-center">${renderColorDots(order.bouquet_colors)}</td>
          <td class="px-3 py-3 text-center text-gray-600 text-sm">${formatDate(order.order_date)}</td>
          <td class="px-3 py-3 text-right font-semibold text-green-600">‡∏ø${formatPrice(order.price)}</td>
          <td class="px-3 py-3 text-gray-500 text-sm max-w-[120px] truncate">${order.notes || '-'}</td>
          <td class="px-3 py-3 text-center">
            <input type="checkbox" class="checkbox-cute paid-checkbox" ${order.is_paid ? 'checked' : ''}>
          </td>
          <td class="px-3 py-3 text-center">
            <button class="delete-btn text-red-400 hover:text-red-600 hover:bg-red-100 p-2 rounded-lg transition-all">
              üóëÔ∏è
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
        
        // Attach event listeners
        const checkbox = row.querySelector('.paid-checkbox');
        const deleteBtn = row.querySelector('.delete-btn');
        
        checkbox.onchange = () => togglePaid(order);
        deleteBtn.onclick = () => showDeleteModal(order);
      });
    }
    
    // Create floating petals
    function createPetals() {
      const container = document.getElementById('petals-container');
      for (let i = 0; i < 15; i++) {
        const petal = document.createElement('div');
        petal.className = 'petal';
        petal.style.left = Math.random() * 100 + '%';
        petal.style.top = Math.random() * 100 + '%';
        petal.style.animationDelay = Math.random() * 5 + 's';
        petal.style.transform = `rotate(${Math.random() * 360}deg)`;
        petal.style.animation = `float ${3 + Math.random() * 4}s ease-in-out infinite`;
        container.appendChild(petal);
      }
    }
    
    // Data handler for SDK
    const dataHandler = {
      onDataChanged(data) {
        if(data) {
           orders = data;
           renderOrders(data);
        }
      }
    };
    
    // Config change handler
    async function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };
      
      // Update shop name
      const titleEl = document.getElementById('shop-title');
      if (titleEl) {
        titleEl.textContent = `üå∏ ${config.shop_name || defaultConfig.shop_name} üå∏`;
      }
      
      // Update subtitle
      const subtitleEl = document.getElementById('shop-subtitle');
      if (subtitleEl) {
        subtitleEl.textContent = config.subtitle_text || defaultConfig.subtitle_text;
      }
      
      // Apply colors
      document.documentElement.style.setProperty('--primary-color', config.primary_color);
      document.documentElement.style.setProperty('--secondary-color', config.secondary_color);
      document.documentElement.style.setProperty('--background-color', config.background_color);
      document.documentElement.style.setProperty('--text-color', config.text_color);
      document.documentElement.style.setProperty('--accent-color', config.accent_color);
    }
    
    // Element SDK initialization
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (cfg) => ({
          recolorables: [
            {
              get: () => cfg.background_color || defaultConfig.background_color,
              set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
            },
            {
              get: () => cfg.secondary_color || defaultConfig.secondary_color,
              set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }
            },
            {
              get: () => cfg.text_color || defaultConfig.text_color,
              set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => cfg.primary_color || defaultConfig.primary_color,
              set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
            },
            {
              get: () => cfg.accent_color || defaultConfig.accent_color,
              set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['shop_name', cfg.shop_name || defaultConfig.shop_name],
          ['subtitle_text', cfg.subtitle_text || defaultConfig.subtitle_text]
        ])
      });
    }
    
    // Initialize app
    async function init() {
      // Set today's date as default
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('order-date').value = today;
      
      // Initialize color pickers
      initColorPickers();
      
      // Create decorative petals
      createPetals();
      
      // Add event listeners
      document.getElementById('add-order-btn').addEventListener('click', addOrder);
      document.getElementById('cancel-delete-btn').addEventListener('click', hideDeleteModal);
      document.getElementById('confirm-delete-btn').addEventListener('click', confirmDelete);
      
      // Close modal on backdrop click
      document.getElementById('delete-modal').addEventListener('click', (e) => {
        if (e.target.id === 'delete-modal') hideDeleteModal();
      });
      
      // Initialize Data SDK
      if (window.dataSdk) {
          const result = await window.dataSdk.init(dataHandler);
          if (!result.isOk) {
            console.error('Failed to initialize data SDK');
          }
      }
    }
    
    init();
  </script>
 </body>
</html>