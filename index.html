<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AAFLOWERSHOP - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&amp;family=Prompt:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; }
    * { font-family: 'Kanit', 'Prompt', sans-serif; }
    
    @keyframes bounce-in {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(236, 72, 153, 0.3); }
      50% { box-shadow: 0 0 20px rgba(236, 72, 153, 0.6); }
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }
    
    .bounce-in { animation: bounce-in 0.6s ease-out; }
    .float { animation: float 3s ease-in-out infinite; }
    .shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }
    .shake { animation: shake 0.5s ease-in-out; }
    .fade-in { animation: fade-in 0.5s ease-out; }
    .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
    
    .color-dot {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: inline-block;
      margin: 1px;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .color-picker-btn {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      border: 3px solid transparent;
    }
    
    .color-picker-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .color-picker-btn.selected {
      border-color: #ec4899;
      transform: scale(1.1);
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.3);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 25%, #fbcfe8 50%, #f9a8d4 75%, #f472b6 100%);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.90);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      transition: all 0.3s;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #db2777 0%, #be185d 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(236, 72, 153, 0.4);
    }
    
    .input-field {
      transition: all 0.3s;
      border: 2px solid #f9a8d4;
    }
    
    .input-field:focus {
      border-color: #ec4899;
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.15);
      outline: none;
    }
    
    .table-row {
      transition: all 0.3s;
    }
    
    .table-row:hover {
      background: rgba(252, 231, 243, 0.5);
      transform: scale(1.005);
    }
    
    .checkbox-cute {
      appearance: none;
      width: 22px;
      height: 22px;
      border: 3px solid #f472b6;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    
    .checkbox-cute:checked {
      background: linear-gradient(135deg, #ec4899, #db2777);
      border-color: #db2777;
    }
    
    .checkbox-cute:checked::after {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      font-size: 12px;
    }
    
    .warning-toast {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-left: 4px solid #f59e0b;
    }
    
    .petal {
      position: absolute;
      width: 15px;
      height: 15px;
      background: #f9a8d4;
      border-radius: 50% 0 50% 50%;
      opacity: 0.6;
      pointer-events: none;
    }
    
    .scrollbar-pink::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .scrollbar-pink::-webkit-scrollbar-track {
      background: #fce7f3;
      border-radius: 10px;
    }
    
    .scrollbar-pink::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #f472b6, #ec4899);
      border-radius: 10px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg scrollbar-pink overflow-auto">
  <div id="app" class="min-h-full w-full p-2 md:p-6"><div class="fixed inset-0 overflow-hidden pointer-events-none" id="petals-container"></div>
  
    <header class="text-center mb-4 bounce-in relative">
     <div class="inline-block">
      <h1 id="shop-title" class="text-2xl md:text-5xl font-bold text-pink-600 float">üå∏ AAFLOWERSHOP üå∏</h1>
     </div>
    </header>

    <div id="warning-toast" class="fixed top-4 left-1/2 transform -translate-x-1/2 warning-toast px-6 py-3 rounded-xl shadow-lg z-50 hidden">
     <div class="flex items-center gap-2"><span class="text-2xl">‚ö†Ô∏è</span> <span class="font-medium text-amber-800">‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!</span>
     </div>
    </div>

    <div id="form-container" class="glass-card rounded-2xl p-3 md:p-6 mb-4 shadow-lg fade-in max-w-3xl mx-auto border-2 border-pink-100">
     <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg md:text-xl font-semibold text-pink-600 flex items-center gap-2"><span class="text-xl">üíê</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
        <button id="toggle-form" class="text-pink-400 text-sm underline md:hidden" onclick="toggleFormVisibility()">‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢</button>
     </div>
     
     <div id="form-content">
         <div class="grid grid-cols-12 gap-2 md:gap-4">
            
            <div class="col-span-12 md:col-span-4">
                <label class="block text-pink-600 font-medium mb-1 text-xs md:text-sm">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ *</label> 
                <input type="text" id="customer-name" class="input-field w-full px-3 py-1.5 rounded-lg bg-white/80 text-gray-700 text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
            </div>

            <div class="col-span-6 md:col-span-2">
                <label class="block text-pink-600 font-medium mb-1 text-xs md:text-sm">üå∑ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô *</label> 
                <input type="number" id="flower-count" class="input-field w-full px-3 py-1.5 rounded-lg bg-white/80 text-gray-700 text-sm" placeholder="0" min="1">
            </div>
            <div class="col-span-6 md:col-span-2">
                <label class="block text-pink-600 font-medium mb-1 text-xs md:text-sm">üé´ ‡∏Ñ‡∏¥‡∏ß *</label> 
                <input type="number" id="queue-number" class="input-field w-full px-3 py-1.5 rounded-lg bg-white/80 text-gray-700 text-sm" placeholder="0" min="1">
            </div>

            <div class="col-span-6 md:col-span-2">
                <label class="block text-pink-600 font-medium mb-1 text-xs md:text-sm">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà *</label> 
                <input type="date" id="order-date" class="input-field w-full px-3 py-1.5 rounded-lg bg-white/80 text-gray-700 text-sm">
            </div>
            <div class="col-span-6 md:col-span-2">
                <label class="block text-pink-600 font-medium mb-1 text-xs md:text-sm">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤ *</label> 
                <input type="number" id="price" class="input-field w-full px-3 py-1.5 rounded-lg bg-white/80 text-gray-700 text-sm" placeholder="0" min="0">
            </div>

            <div class="col-span-12">
                <label class="block text-pink-600 font-medium mb-1 text-xs md:text-sm">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> 
                <input type="text" id="notes" class="input-field w-full px-3 py-1.5 rounded-lg bg-white/80 text-gray-700 text-sm" placeholder="‡∏≠‡∏∑‡πà‡∏ô‡πÜ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
            </div>
         </div>

         <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-3">
            <div class="bg-purple-50 rounded-xl p-2 border border-purple-100">
                <div class="flex justify-between items-center mb-1">
                    <label class="text-purple-600 font-semibold text-xs flex items-center gap-1"> üå∏ ‡∏™‡∏µ‡∏î‡∏≠‡∏Å </label>
                    <div class="flex flex-wrap gap-1 min-h-[20px]" id="selected-flower-colors"><span class="text-purple-300 text-[10px]">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ</span></div>
                </div>
                <div id="flower-colors-picker" class="flex flex-wrap gap-1 justify-start"></div>
            </div>
            
            <div class="bg-purple-50 rounded-xl p-2 border border-purple-100">
                <div class="flex justify-between items-center mb-1">
                    <label class="text-purple-600 font-semibold text-xs flex items-center gap-1"> üíê ‡∏™‡∏µ‡∏ä‡πà‡∏≠ </label>
                    <div class="flex flex-wrap gap-1 min-h-[20px]" id="selected-bouquet-colors"><span class="text-purple-300 text-[10px]">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ</span></div>
                </div>
                <div id="bouquet-colors-picker" class="flex flex-wrap gap-1 justify-start"></div>
            </div>
         </div>

         <div class="mt-4 text-center">
            <button id="add-order-btn" class="btn-primary text-white w-full md:w-auto px-6 py-2 rounded-xl font-semibold text-base shadow-md active:scale-95 transition-transform"> ‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‚ú® </button>
         </div>
     </div>
    </div>

    <div class="glass-card rounded-3xl p-3 md:p-6 shadow-2xl fade-in w-full mx-auto overflow-hidden min-h-[500px] flex flex-col">
     <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2 sticky left-0">
      <h2 class="text-xl font-semibold text-pink-600 flex items-center gap-2"><span class="text-2xl">üìã</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
      <div class="flex items-center gap-2">
          <span id="order-count" class="bg-pink-100 text-pink-700 px-3 py-1 rounded-full text-xs font-medium border border-pink-200">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span> 
          <span id="total-revenue" class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium border border-green-200">‡∏ø0</span>
      </div>
     </div>
     
     <div class="overflow-x-auto scrollbar-pink flex-grow">
      <table class="w-full min-w-[800px] border-collapse">
       <thead class="sticky top-0 z-10">
        <tr class="bg-pink-200 text-pink-800">
         <th class="px-2 py-3 rounded-tl-lg text-left text-sm whitespace-nowrap">‡∏Ñ‡∏¥‡∏ß</th>
         <th class="px-2 py-3 text-left text-sm whitespace-nowrap">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
         <th class="px-2 py-3 text-center text-sm whitespace-nowrap">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
         <th class="px-2 py-3 text-center text-sm whitespace-nowrap">‡∏™‡∏µ‡∏î‡∏≠‡∏Å</th>
         <th class="px-2 py-3 text-center text-sm whitespace-nowrap">‡∏™‡∏µ‡∏ä‡πà‡∏≠</th>
         <th class="px-2 py-3 text-center text-sm whitespace-nowrap">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
         <th class="px-2 py-3 text-right text-sm whitespace-nowrap">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
         <th class="px-2 py-3 text-left text-sm min-w-[150px]">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
         <th class="px-2 py-3 text-center text-sm whitespace-nowrap">‡∏à‡πà‡∏≤‡∏¢</th>
         <th class="px-2 py-3 rounded-tr-lg text-center text-sm whitespace-nowrap">‡∏•‡∏ö</th>
        </tr>
       </thead>
       <tbody id="orders-table-body" class="bg-white/50">
        <tr>
         <td colspan="10" class="text-center py-12 text-pink-400">
          <div class="text-5xl mb-3 opacity-50">üå∑</div>
          <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>

    <div id="delete-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
     <div class="glass-card rounded-3xl p-6 max-w-xs w-full bounce-in text-center">
       <div class="text-5xl mb-4">üóëÔ∏è</div>
       <h3 class="text-lg font-semibold text-pink-600 mb-2">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?</h3>
       <div class="flex gap-2 justify-center mt-4">
           <button id="cancel-delete-btn" class="flex-1 px-4 py-2 rounded-xl bg-gray-100 text-gray-600 text-sm font-medium hover:bg-gray-200"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> 
           <button id="confirm-delete-btn" class="flex-1 px-4 py-2 rounded-xl bg-red-500 text-white text-sm font-medium hover:bg-red-600 shadow-lg shadow-red-200"> ‡∏•‡∏ö‡πÄ‡∏•‡∏¢ </button>
       </div>
     </div>
    </div>
  </div>

  <script>
    // --- MOCK SDK ---
    if (!window.dataSdk) {
      window.dataSdk = {
        init: async (handler) => { window._mockHandler = handler; return { isOk: true }; },
        create: async (data) => { await new Promise(r => setTimeout(r, 300)); return { isOk: true }; },
        update: async (data) => { return { isOk: true }; },
        delete: async (data) => { return { isOk: true }; }
      };
    }

    const colorPalette = [
      '#FF4444', '#FF8888', '#FF69B4', '#FFB6C1', '#FFE4E1',
      '#FF7F50', '#FFA500', '#FFD700', '#FFFFE0', '#98FB98',
      '#2E8B57', '#40E0D0', '#87CEEB', '#4169E1', '#9400D3',
      '#DDA0DD', '#D2691E', '#F5F5F5', '#808080', '#000000',
    ];
    
    let orders = [];
    let selectedFlowerColors = [];
    let selectedBouquetColors = [];
    let pendingDeleteRecord = null;
    let isLoading = false;
    
    const defaultConfig = {
      shop_name: 'AAFLOWERSHOP',
      subtitle_text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ',
      primary_color: '#EC4899',
      secondary_color: '#F9A8D4',
      background_color: '#FDF2F8',
      text_color: '#831843',
      accent_color: '#DB2777'
    };
    
    let config = { ...defaultConfig };
    
    function toggleFormVisibility() {
        const content = document.getElementById('form-content');
        if (content.style.display === 'none') {
            content.style.display = 'block';
        } else {
            content.style.display = 'none';
        }
    }

    function initColorPickers() {
      const flowerPicker = document.getElementById('flower-colors-picker');
      const bouquetPicker = document.getElementById('bouquet-colors-picker');
      
      colorPalette.forEach(color => {
        const flowerBtn = document.createElement('button');
        flowerBtn.type = 'button';
        flowerBtn.className = 'color-picker-btn';
        flowerBtn.style.backgroundColor = color;
        flowerBtn.onclick = () => toggleFlowerColor(color, flowerBtn);
        flowerPicker.appendChild(flowerBtn);
        
        const bouquetBtn = document.createElement('button');
        bouquetBtn.type = 'button';
        bouquetBtn.className = 'color-picker-btn';
        bouquetBtn.style.backgroundColor = color;
        bouquetBtn.onclick = () => toggleBouquetColor(color, bouquetBtn);
        bouquetPicker.appendChild(bouquetBtn);
      });
    }
    
    function toggleFlowerColor(color, btn) {
      const index = selectedFlowerColors.indexOf(color);
      if (index > -1) {
        selectedFlowerColors.splice(index, 1);
        btn.classList.remove('selected');
      } else {
        selectedFlowerColors.push(color);
        btn.classList.add('selected');
      }
      updateSelectedColorsDisplay('flower');
    }
    
    function toggleBouquetColor(color, btn) {
      const index = selectedBouquetColors.indexOf(color);
      if (index > -1) {
        selectedBouquetColors.splice(index, 1);
        btn.classList.remove('selected');
      } else {
        selectedBouquetColors.push(color);
        btn.classList.add('selected');
      }
      updateSelectedColorsDisplay('bouquet');
    }
    
    function updateSelectedColorsDisplay(type) {
      const container = document.getElementById(type === 'flower' ? 'selected-flower-colors' : 'selected-bouquet-colors');
      const colors = type === 'flower' ? selectedFlowerColors : selectedBouquetColors;
      
      if (colors.length === 0) {
        container.innerHTML = `<span class="text-purple-300 text-[10px]">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ</span>`;
      } else {
        container.innerHTML = colors.map(c => 
          `<span class="color-dot" style="background-color: ${c}; width: 14px; height: 14px;" title="${c}"></span>`
        ).join('');
      }
    }
    
    function renderColorDots(colorsString) {
      if (!colorsString) return '<span class="text-gray-300">-</span>';
      const colors = colorsString.split(',').filter(c => c);
      if (colors.length === 0) return '<span class="text-gray-300">-</span>';
      return colors.map(c => 
        `<span class="color-dot" style="background-color: ${c};" title="${c}"></span>`
      ).join('');
    }
    
    function showWarning() {
      const toast = document.getElementById('warning-toast');
      const formContainer = document.getElementById('form-container');
      
      toast.classList.remove('hidden');
      formContainer.classList.add('shake');
      
      setTimeout(() => {
        toast.classList.add('hidden');
        formContainer.classList.remove('shake');
      }, 2000);
    }
    
    function validateForm() {
      const name = document.getElementById('customer-name').value.trim();
      const count = document.getElementById('flower-count').value;
      const queue = document.getElementById('queue-number').value;
      const date = document.getElementById('order-date').value;
      const price = document.getElementById('price').value;
      
      return name && count && queue && date && price;
    }
    
    function clearForm() {
      document.getElementById('customer-name').value = '';
      document.getElementById('flower-count').value = '';
      document.getElementById('queue-number').value = '';
      document.getElementById('price').value = '';
      document.getElementById('notes').value = '';
      
      selectedFlowerColors = [];
      selectedBouquetColors = [];
      
      document.querySelectorAll('.color-picker-btn.selected').forEach(btn => btn.classList.remove('selected'));
      
      updateSelectedColorsDisplay('flower');
      updateSelectedColorsDisplay('bouquet');
      
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('order-date').value = today;
    }
    
    async function addOrder() {
      if (isLoading) return;
      
      if (!validateForm()) {
        showWarning();
        return;
      }
      
      const orderData = {
        customer_name: document.getElementById('customer-name').value.trim(),
        flower_count: parseInt(document.getElementById('flower-count').value),
        flower_colors: selectedFlowerColors.join(','),
        bouquet_colors: selectedBouquetColors.join(','),
        order_date: document.getElementById('order-date').value,
        price: parseFloat(document.getElementById('price').value),
        notes: document.getElementById('notes').value.trim(),
        queue_number: parseInt(document.getElementById('queue-number').value),
        is_paid: false,
        created_at: new Date().toISOString()
      };
      
      isLoading = true;
      const btn = document.getElementById('add-order-btn');
      const originalText = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '‚è≥...';
      
      try {
        const result = await window.dataSdk.create(orderData);
        if (result.isOk) {
          const tempOrder = { ...orderData, __backendId: 'temp_' + Date.now() };
          orders.push(tempOrder);
          renderOrders(orders);
          clearForm();
        } else {
          showWarning();
        }
      } catch (e) {
        console.error(e);
        showWarning();
      }
      isLoading = false;
      btn.disabled = false;
      btn.innerHTML = originalText;
    }
    
    async function togglePaid(record) {
      if (isLoading) return;
      record.is_paid = !record.is_paid;
      renderOrders(orders);
      isLoading = true;
      try { await window.dataSdk.update(record); } catch(e) { record.is_paid = !record.is_paid; renderOrders(orders); }
      isLoading = false;
    }
    
    function showDeleteModal(record) {
      pendingDeleteRecord = record;
      document.getElementById('delete-modal').classList.remove('hidden');
    }
    
    function hideDeleteModal() {
      pendingDeleteRecord = null;
      document.getElementById('delete-modal').classList.add('hidden');
    }
    
    async function confirmDelete() {
      if (!pendingDeleteRecord || isLoading) return;
      isLoading = true;
      document.getElementById('confirm-delete-btn').textContent = '...';
      try {
        await window.dataSdk.delete(pendingDeleteRecord);
        orders = orders.filter(o => o.__backendId !== pendingDeleteRecord.__backendId);
        renderOrders(orders);
      } catch(e) {}
      isLoading = false;
      document.getElementById('confirm-delete-btn').textContent = '‡∏•‡∏ö‡πÄ‡∏•‡∏¢';
      hideDeleteModal();
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return '-';
      const date = new Date(dateStr);
      return date.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
    }
    
    function formatPrice(price) {
      return new Intl.NumberFormat('th-TH').format(price || 0);
    }
    
    function renderOrders(data) {
      const tbody = document.getElementById('orders-table-body');
      const countEl = document.getElementById('order-count');
      const revenueEl = document.getElementById('total-revenue');
      
      const sortedData = [...data].sort((a, b) => (a.queue_number || 0) - (b.queue_number || 0));
      
      countEl.textContent = `${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      const totalRevenue = data.reduce((sum, o) => sum + (o.price || 0), 0);
      revenueEl.textContent = `‡∏ø${formatPrice(totalRevenue)}`;
      
      if (sortedData.length === 0) {
        tbody.innerHTML = `<tr><td colspan="10" class="text-center py-12 text-pink-400"><div class="text-5xl mb-3 opacity-50">üå∑</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p></td></tr>`;
        return;
      }
      
      tbody.innerHTML = '';
      
      sortedData.forEach((order, index) => {
        const id = order.__backendId || ('temp_' + index);
        const row = document.createElement('tr');
        row.className = `table-row ${index % 2 === 0 ? 'bg-white/40' : 'bg-pink-50/40'} border-b border-pink-100/50`;
        
        row.innerHTML = `
          <td class="px-2 py-3 text-center"><span class="bg-pink-100 text-pink-700 px-2 py-0.5 rounded-md text-xs font-bold border border-pink-200">${order.queue_number || '-'}</span></td>
          <td class="px-2 py-3 font-medium text-gray-700 text-sm">${order.customer_name || '-'}</td>
          <td class="px-2 py-3 text-center text-gray-600 text-sm">${order.flower_count || 0}</td>
          <td class="px-2 py-3 text-center">${renderColorDots(order.flower_colors)}</td>
          <td class="px-2 py-3 text-center">${renderColorDots(order.bouquet_colors)}</td>
          <td class="px-2 py-3 text-center text-gray-500 text-xs">${formatDate(order.order_date)}</td>
          <td class="px-2 py-3 text-right font-semibold text-green-600 text-sm">‡∏ø${formatPrice(order.price)}</td>
          <td class="px-2 py-3 text-gray-500 text-xs truncate max-w-[100px]">${order.notes || '-'}</td>
          <td class="px-2 py-3 text-center"><input type="checkbox" class="checkbox-cute paid-checkbox scale-90" ${order.is_paid ? 'checked' : ''}></td>
          <td class="px-2 py-3 text-center"><button class="delete-btn text-red-400 hover:text-red-600 p-1.5 rounded-lg hover:bg-red-50 transition-colors">üóëÔ∏è</button></td>
        `;
        
        row.querySelector('.paid-checkbox').onchange = () => togglePaid(order);
        row.querySelector('.delete-btn').onclick = () => showDeleteModal(order);
        tbody.appendChild(row);
      });
    }
    
    function createPetals() {
      const container = document.getElementById('petals-container');
      for (let i = 0; i < 10; i++) {
        const petal = document.createElement('div');
        petal.className = 'petal';
        petal.style.left = Math.random() * 100 + '%';
        petal.style.top = Math.random() * 100 + '%';
        petal.style.animationDelay = Math.random() * 5 + 's';
        petal.style.animation = `float ${5 + Math.random() * 5}s ease-in-out infinite`;
        container.appendChild(petal);
      }
    }
    
    // SDK Hooks
    const dataHandler = { onDataChanged(data) { if(data) { orders = data; renderOrders(data); } } };
    async function onConfigChange(cfg) {
        config = { ...defaultConfig, ...cfg };
        const titleEl = document.getElementById('shop-title');
        if (titleEl) titleEl.textContent = `üå∏ ${config.shop_name || defaultConfig.shop_name} üå∏`;
    }
    
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig, onConfigChange,
        mapToCapabilities: (cfg) => ({ recolorables: [], borderables: [] }),
        mapToEditPanelValues: (cfg) => new Map([['shop_name', cfg.shop_name]])
      });
    }
    
    async function init() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('order-date').value = today;
      initColorPickers();
      createPetals();
      document.getElementById('add-order-btn').addEventListener('click', addOrder);
      document.getElementById('cancel-delete-btn').addEventListener('click', hideDeleteModal);
      document.getElementById('confirm-delete-btn').addEventListener('click', confirmDelete);
      document.getElementById('delete-modal').addEventListener('click', (e) => { if (e.target.id === 'delete-modal') hideDeleteModal(); });
      
      if (window.dataSdk) await window.dataSdk.init(dataHandler);
    }
    
    init();
  </script>
 </body>
</html>
